version: 2
models:
  - name: stg_crm__customer_registration_source
    description: "Staging model for Registration Sources"
    columns:
      - name: REGISTRATION_SOURCE_ID
        data_tests:
          - unique:
              config: {severity: error}
          - not_null:
              config: {severity: error}
      - name: CHANNEL
        data_tests:
          - not_null:
              config: {severity: error}

  - name: stg_crm__incidents
    description: "Staging model for Incidents"
    columns:
      - name: INCIDENT_ID
        data_tests:
          - unique:
              config: {severity: error}
          - not_null:
              config: {severity: error}

  - name: stg_crm__interactions
    description: "Staging model for Interactions"
    columns:
      - name: INTERACTION_ID
        data_tests:
          - unique:
              config: {severity: error}
          - not_null:
              config: {severity: error}

  - name: stg_crm__surveys
    description: "Staging model for Surveys"
    columns:
      - name: SURVEY_ID
        data_tests:
          - unique:
              config: {severity: error}
          - not_null:
              config: {severity: error}
      - name: NPS_SCORE
        data_tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
                max_value: 10
              config: {severity: warn}
      - name: CSAT_SCORE
        data_tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 1
                max_value: 5
              config: {severity: warn}

  - name: snp_crm__customers
    description: "SCD2 Snapshot for Customers"
    columns:
      - name: dbt_scd_id
        data_tests:
          - unique:
              config: {severity: error}
          - not_null:
              config: {severity: error}
      - name: CUSTOMER_ID
        data_tests:
          - not_null:
              config: {severity: error}
      - name: EMAIL
        data_tests:
          - not_null:
              config: {severity: error}
          - dbt_expectations.expect_column_values_to_match_regex:
              arguments:
                regex: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
              config: {severity: warn}
      - name: REGISTRATION_DATE
        data_tests:
          - not_null:
              config: {severity: error}
      - name: dbt_valid_from
        data_tests:
          - not_null:
              config: {severity: error}
      - name: dbt_is_current
        data_tests:
          - not_null:
              config: {severity: error}