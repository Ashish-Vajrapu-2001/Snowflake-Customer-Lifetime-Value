version: 2
sources:
  - name: bronze_crm
    database: "{{ env_var('DBT_BRONZE_DB', 'BRONZE') }}"
    schema: BRONZE_CRM
    config:
      loaded_at_field: _FIVETRAN_SYNCED
      freshness:
        warn_after: {count: 60, period: minute}
        error_after: {count: 240, period: minute}
    tables:
      - name: CUSTOMERS
        description: "Golden record for customer identity and profile."
        columns:
          - name: CUSTOMER_ID
            description: "Unique system-generated customer identifier"
          - name: EMAIL
            description: "Primary email address"
          - name: PHONE
            description: "Primary contact phone"
          - name: FIRST_NAME
            description: "Customer's given name"
          - name: LAST_NAME
            description: "Customer's family name"
          - name: GENDER
            description: "Customer's gender identity"
          - name: DATE_OF_BIRTH
            description: "Customer's birth date"
          - name: REGISTRATION_DATE
            description: "Account creation timestamp"
          - name: CUSTOMER_TYPE
            description: "Customer classification"
          - name: STATUS
            description: "Account status"
          - name: EMAIL_VERIFIED
            description: "Email verification flag"
          - name: PHONE_VERIFIED
            description: "Phone verification flag"
          - name: MARKETING_OPT_IN
            description: "Marketing consent flag"
          - name: PREFERRED_LANGUAGE
            description: "Communication language preference"
          - name: CREATED_BY
            description: "Record creator"
          - name: CREATED_DATE
            description: "Record creation timestamp"
          - name: LAST_UPDATE_DATE
            description: "Last modification timestamp"
          - name: LAST_MODIFIED_DATE
            description: "Last modification timestamp (audit trail)"
          - name: _FIVETRAN_SYNCED
            description: "Fivetran sync timestamp"
          - name: _FIVETRAN_DELETED
            description: "Fivetran soft delete flag"

      - name: CUSTOMERREGISTRATIONSOURCE
        description: "Captures the acquisition channel and campaign attribution."
        columns:
          - name: REGISTRATION_SOURCE_ID
            description: "Unique record identifier"
          - name: CUSTOMER_ID
            description: "Link to customer master"
          - name: CHANNEL
            description: "Acquisition channel"
          - name: CAMPAIGN_ID
            description: "Associated marketing campaign"
          - name: UTM_SOURCE
            description: "UTM source parameter"
          - name: UTM_MEDIUM
            description: "UTM medium parameter"
          - name: UTM_CAMPAIGN
            description: "UTM campaign parameter"
          - name: UTM_CONTENT
            description: "UTM content parameter"
          - name: REFERRER_URL
            description: "HTTP referrer URL"
          - name: LANDING_PAGE
            description: "First page visited"
          - name: DEVICE_TYPE
            description: "Registration device"
          - name: REGISTRATION_DATE
            description: "Registration timestamp"
          - name: CREATED_DATE
            description: "Record creation timestamp"
          - name: LAST_MODIFIED_DATE
            description: "Last modification timestamp (audit trail)"
          - name: _FIVETRAN_SYNCED
            description: "Fivetran sync timestamp"
          - name: _FIVETRAN_DELETED
            description: "Fivetran soft delete flag"

      - name: INCIDENTS
        description: "Customer support tickets."
        columns:
          - name: INCIDENT_ID
            description: "Unique incident ID"
          - name: INCIDENT_NUMBER
            description: "Ticket number"
          - name: CUSTOMER_ID
            description: "Customer"
          - name: ORDER_ID
            description: "Related order"
          - name: SUBJECT
            description: "Subject"
          - name: DESCRIPTION
            description: "Description"
          - name: CATEGORY
            description: "Issue category"
          - name: SUB_CATEGORY
            description: "Sub-category"
          - name: PRIORITY
            description: "Priority"
          - name: STATUS
            description: "Status"
          - name: CHANNEL
            description: "Contact channel"
          - name: ASSIGNED_TO
            description: "Assigned agent"
          - name: FIRST_RESPONSE_DATE
            description: "First response"
          - name: RESOLVED_DATE
            description: "Resolution date"
          - name: CLOSED_DATE
            description: "Closure date"
          - name: LAST_MODIFIED_DATE
            description: "Last modification timestamp (audit trail)"
          - name: _FIVETRAN_SYNCED
            description: "Fivetran sync timestamp"
          - name: _FIVETRAN_DELETED
            description: "Fivetran soft delete flag"

      - name: INTERACTIONS
        description: "Individual customer touchpoints across channels."
        columns:
          - name: INTERACTION_ID
            description: "Unique interaction ID"
          - name: INCIDENT_ID
            description: "Parent incident"
          - name: CUSTOMER_ID
            description: "Customer"
          - name: CHANNEL
            description: "Communication channel"
          - name: DIRECTION
            description: "Inbound/Outbound"
          - name: INTERACTION_TYPE
            description: "Interaction type"
          - name: SUBJECT
            description: "Subject"
          - name: CONTENT_SUMMARY
            description: "Summary"
          - name: SENTIMENT
            description: "Detected sentiment"
          - name: AGENT_ID
            description: "Agent ID"
          - name: DURATION_SECONDS
            description: "Duration"
          - name: INTERACTION_DATE
            description: "Interaction date"
          - name: LAST_MODIFIED_DATE
            description: "Last modification timestamp (audit trail)"
          - name: _FIVETRAN_SYNCED
            description: "Fivetran sync timestamp"
          - name: _FIVETRAN_DELETED
            description: "Fivetran soft delete flag"

      - name: SURVEYS
        description: "Customer feedback surveys (NPS, CSAT)."
        columns:
          - name: SURVEY_ID
            description: "Unique survey ID"
          - name: CUSTOMER_ID
            description: "Customer"
          - name: ORDER_ID
            description: "Related order"
          - name: INCIDENT_ID
            description: "Related incident"
          - name: SURVEY_TYPE
            description: "Survey type"
          - name: NPS_SCORE
            description: "NPS (0-10)"
          - name: CSAT_SCORE
            description: "CSAT (1-5)"
          - name: NPS_CATEGORY
            description: "NPS category"
          - name: FEEDBACK_TEXT
            description: "Feedback text"
          - name: FEEDBACK_CATEGORY
            description: "Feedback category"
          - name: RESPONSE_DATE
            description: "Response date"
          - name: SURVEY_SENT_DATE
            description: "Sent date"
          - name: LAST_MODIFIED_DATE
            description: "Last modification timestamp (audit trail)"
          - name: _FIVETRAN_SYNCED
            description: "Fivetran sync timestamp"
          - name: _FIVETRAN_DELETED
            description: "Fivetran soft delete flag"