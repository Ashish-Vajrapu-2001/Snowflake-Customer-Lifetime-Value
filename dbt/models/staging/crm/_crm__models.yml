version: 2
models:
  - name: stg_crm__customer_registration_source
    description: "Silver layer registration sources."
    columns:
      - name: REGISTRATION_SOURCE_ID
        data_tests:
          - unique:
              config: {severity: error}
          - not_null:
              config: {severity: error}
      - name: CUSTOMER_ID
        data_tests:
          - not_null:
              config: {severity: error}
      - name: CHANNEL
        data_tests:
          - not_null:
              config: {severity: error}

  - name: stg_crm__incidents
    description: "Silver layer incidents."
    columns:
      - name: INCIDENT_ID
        data_tests:
          - unique:
              config: {severity: error}
          - not_null:
              config: {severity: error}
      - name: CUSTOMER_ID
        data_tests:
          - not_null:
              config: {severity: error}

  - name: stg_crm__interactions
    description: "Silver layer interactions."
    columns:
      - name: INTERACTION_ID
        data_tests:
          - unique:
              config: {severity: error}
          - not_null:
              config: {severity: error}
      - name: CUSTOMER_ID
        data_tests:
          - not_null:
              config: {severity: error}

  - name: stg_crm__surveys
    description: "Silver layer surveys."
    columns:
      - name: SURVEY_ID
        data_tests:
          - unique:
              config: {severity: error}
          - not_null:
              config: {severity: error}
      - name: NPS_SCORE
        data_tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
                max_value: 10
              config: {severity: error}
      - name: CSAT_SCORE
        data_tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 1
                max_value: 5
              config: {severity: warn}

  - name: snp_crm__customers
    description: "SCD2 snapshot of customers."
    columns:
      - name: dbt_scd_id
        data_tests:
          - unique:
              config: {severity: error}
          - not_null:
              config: {severity: error}
      - name: CUSTOMER_ID
        data_tests:
          - not_null:
              config: {severity: error}
      - name: EMAIL
        data_tests:
          - not_null:
              config: {severity: error}
          - test_email_format:
              config: {severity: warn}
      - name: REGISTRATION_DATE
        data_tests:
          - not_null:
              config: {severity: error}